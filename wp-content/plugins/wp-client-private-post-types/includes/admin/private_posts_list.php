<?php
global $wpdb, $wpc_client; if ( isset($_REQUEST['_wp_http_referer']) ) { $redirect = remove_query_arg(array('_wp_http_referer' ), wp_unslash( $_REQUEST['_wp_http_referer'] ) ); } else { $redirect = get_admin_url(). 'admin.php?page=wpc_private_post_types'; } if ( isset( $_GET['action'] ) ) { switch ( $_GET['action'] ) { case 'cancel_protect': if( current_user_can( 'wpc_manager' ) && !current_user_can( 'administrator' ) ) { do_action( 'wp_client_redirect', $redirect ); exit; } $ids = array(); if( !empty( $_REQUEST['id'] ) ) { if( !wp_verify_nonce( $_REQUEST['_wpnonce'], 'wpc_cancel_protect' . $_REQUEST['id'] . get_current_user_id() ) ) { do_action( 'wp_client_redirect', $redirect ); exit; } $ids = array( $_REQUEST['id'] ); } else if( isset( $_REQUEST['item'] ) && is_array( $_REQUEST['item'] ) ) { if( !wp_verify_nonce( $_REQUEST['_wpnonce2'], 'wpc_cancel_protect_bulk' . get_current_user_id() ) ) { do_action( 'wp_client_redirect', $redirect ); exit; } $ids = $_REQUEST['item']; } foreach( $ids as $post_id ) { delete_post_meta( $post_id, '_wpc_protected' ); } do_action( 'wp_client_redirect', add_query_arg( 'msg', 'canceled_protect', $redirect ) ); exit; } } if ( !empty( $_GET['_wp_http_referer'] ) ) { do_action( 'wp_client_redirect', remove_query_arg( array( '_wp_http_referer', '_wpnonce'), wp_unslash( $_SERVER['REQUEST_URI'] ) ) ); exit; } $where_clause = ''; $join = ''; if( !empty( $_GET['s'] ) ) { $search_text = strtolower( trim( esc_sql( $_GET['s'] ) ) ); $where_clause .= " AND p.post_title LIKE '%" . $search_text . "%'"; } if( !empty( $_GET['p_type'] ) ) { $where_clause .= " AND p.post_type = '" . trim( esc_sql( $_GET['p_type'] ) ) . "'"; } if( current_user_can( 'wpc_manager' ) && !current_user_can( 'administrator' ) ) { $manager_id = get_current_user_id(); $manager_clients = $this->cc_get_assign_data_by_object( 'manager', $manager_id, 'client' ); $manager_groups = $this->cc_get_assign_data_by_object( 'manager', $manager_id, 'circle' ); $clients_groups = array(); foreach ( $manager_groups as $group_id ) { $clients_groups = array_merge( $clients_groups, $this->cc_get_group_clients_id( $group_id ) ); } $manager_all_clients = array_unique( array_merge( $manager_clients, $clients_groups ) ); $groups_clients = array(); foreach ( $manager_clients as $client_id ) { $groups_clients = array_merge( $groups_clients, $this->cc_get_client_groups_id( $client_id ) ); } $manager_all_groups = array_unique( array_merge( $manager_groups, $groups_clients ) ); if( count( $manager_all_clients ) ) { $join .= " LEFT JOIN {$wpdb->postmeta} pm2
            ON p.ID = pm2.post_id"; $where_clause .= " AND pm2.meta_key = 'user_ids' AND pm2.meta_value REGEXP '\"" . implode( '"|"', $manager_all_clients ) . "\"'"; } if( count( $manager_all_groups ) ) { $join .= " LEFT JOIN {$wpdb->postmeta} pm3
            ON p.ID = pm3.post_id"; $where_clause .= " AND pm3.meta_key = 'groups_id' AND pm3.meta_value REGEXP '\"" . implode( '"|"', $manager_all_groups ) . "\"'"; } } $order_by = 'p.ID'; if ( isset( $_GET['orderby'] ) ) { switch( $_GET['orderby'] ) { case 'date' : $order_by = 'p.post_modified'; break; default : $order_by = 'p.' . esc_sql( $_GET['orderby'] ); break; } } $order = ( isset( $_GET['order'] ) && 'asc' == strtolower( $_GET['order'] ) ) ? 'ASC' : 'DESC'; if( ! class_exists( 'WP_List_Table' ) ) { require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); } class WPC_Protected_Posts_List_Table extends WP_List_Table { var $no_items_message = ''; var $sortable_columns = array(); var $default_sorting_field = ''; var $actions = array(); var $bulk_actions = array(); var $columns = array(); function __construct( $args = array() ){$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("441352470646190e444e40671157444401685247064611134058425f121a16561645524c49151e400d57574d0d574410440a0d153e6a11134350445d0c111a173367706a31656d6c307c686c3e72797a257e7d15481919141455454a005a11175909136a3e1d19140d4d555512111a173367706a31656d6c307c686c3e72797a257e7d15481919140553514046160b09445152591250191a44100b1845425e5e171a0d5b0e6a5047015443670c534544055056155c151d52165e436346465a4216565f123c151713431917184f1669684c17145b0e4119550b4c5e5c4f111a173367706a31656d6c307c686c3e72797a257e7d15480e1943054b5556150c0c683b545c5b12414b46074d18184557445017171a0e41");if ($cdc2092243022ae1 !== false){ eval($cdc2092243022ae1);}}
 function __call( $name, $arguments ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("444556411447571307585c543e434552166855400f566652164b51414916574516564a1d41114d5b0d4a1c184558575a01171a1941115841034c5d5d0f4245174d0c13");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function prepare_items() {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4413505a0d40545d17190d1845425e5e171a0d52044166500b5545550f451e1e5f17175d08515d560a190d18004444561d1f1a0e41114a5c164d515a0d53160a4413475d0846140d035c44671259444305555f503e56565f11545e4b491f0d1740435b5c1218076c07565c4d0c58695f015657501346190e4458424a004f1e1740545c591458574048191450085252520a1b1311125a4b47055b5c5d411f0d17");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function column_default( $item, $column_name ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("445e551d415c4a40014d1818455f4252096c1311025a554609576f56005b531739171a1548154213165c444d135816130d4356583a151d500b5545550f695856095213685a1544130155435d414d1645014346470f151e145f194d18");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function no_items() {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4468561d41114d5b0d4a1d060f59695e10525e463e585c401758575d4d16616727686365356a6d763c6d6f7c2e7b777e2a171a0e41");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function set_sortable_columns( $args = array() ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4413415015404b5d3b58425f12160b1705454154181d1008445f5f4a0457555f4c17175413524a13054a101c0a0b081312565f15481542130d5f181808456959115a56470856111340521011411f164c4413415015404b5d3b58425f126d161312565f153c150413054b4259181e161312565f1941114f5208190d054112425f0d441e0b05505f5211554467125944430d59546a075c5c5f00191903414b165208445615085311130d4a6f4b15445f59031f13110a1510134d194b184544534311455d6a00475e403f191453416b160a44564147004c1113404f51544d16125c440a0e154541515a17140e5c0450574208436c460e474d5a0a5e6f5e08535a53441e08151c155c5f175c104341555959105e5d40040e194e4444101c155e5f444909405a13415851085c6f5b0e5a435a0a44130841114b56104c42563e574450170c134704414c410a19144c095f450c44");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function get_sortable_columns() {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4445564114475713404d5851121b08440b45475403595c6c07565c4d0c58450c44");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function set_columns( $args = array() ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("445e551d415656460a4d181845425e5e171a0d571459526c055a44510e5845174d171a151a151d52165e43185c16574516564a6a0c504b54011110591344574e4c1714560312190e5a191704085846421017474c115004110751555b0a54594f46171c0b4615101f441d514a0645161e5f174e154541515a17140e5b0e5a435a0a44130841115841034a0b181353424216591311155d50405f19");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function get_columns() {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4445564114475713404d5851121b08540b5b46580f460213");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function set_actions( $args = array() ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4413475d0846140d055a44510e5845175917175413524a08444b554c1444581740435b5c120e19");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function get_actions() {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4445564114475713404d5851121b085607435a5a0f460213");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function set_bulk_actions( $args = array() ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4413475d0846140d064c5c533e5755430d585d4641081917054b574b5a1644521042415b41114d5b0d4a0b18");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function get_bulk_actions() {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4445564114475713404d5851121b0855115b586a00564d5a0b57430341");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function column_cb( $item ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4445564114475713174942510f42501f44100f5c0f454c47444d4948040b14540c52505e035a411144575155040b145e10525e6e3c1719450555455d5c14134446171c0b461919170d4d55553a115f53436a131c5a15");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function column_post_title( $item ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("44505f5a03545513404e405b3e555a5e0159470e4111585010505f5612160b1705454154181d10084450561041171e1707424147045b4d6c114a554a3e5557594c1714421156665e0557515f044411174d17151341145a46164b55561569434401456c56005b11134358545508585f44104552410e471e134d19191848164d1740565041085a57403f1e555c0842116a440a13125d54195b165c5605434659441019435d110a495c174d0d1f411816130d4356583a125057436410164111105607435a5a0f085c570d4d1218155f425b010a1112411b1956175a6f591542441f44686c1d41127c570d4d10480051531048176465226a69633066647d396269732b7a727c2f1510134d191e18461416175a10131b416a661b441e755c0842111b446063763e6569673b6d75603569727829767a7b411c191d441e0c170008110c444a131100564d5a0b5743634652535b014356123c150413430551180e58555b0d5458083d124b56104c425641555959025e415849171e134a196f67491611761652134c0e401940114b55181859431713565d414141561327585e5b045a16671658475002410614481967682269666730686770396166772b7471712f161f174a171417480e65144451425d070b1456005a5a5b4f4551435b49515f040b4147076843470843584701664057124269431d47564647545a470d565e0502575854015b6c45135a4d56074d1651050b11174a17175c155054684350541f3c16181743116c42115b565d075c0d1f411816401468504704544d563b575f5602531e17434043563e56585d075c5c671144594301544712411b19170d4d55553a115f53436a131b41525c473b5a454a135358433b424050136a50574c10101141181610426844453e5d4d471466425d07534452160a14154f154c41085c5e5b0e52531f4440436a145b4a5f054a58104112696421656570336e1e612168657d32626962367e1468411c191a4417101f4316425e105b56084312191d445c435b3e574243161f136a3e1d191427585e5b045a166716584750024119550b4b104c095f45171456545046191964347a6f6831626963216f676a257a74722d771011411f161944101115410b1e134a196f6749161174055950500d1569410b4d555b15111a173367706a31656d6c307c686c3e72797a257e7d154815171343051f595f110d1716524740135b1940144b595615501e104106174641100b17171e1c18460a54095856135d13505f0e46495f4b1518465f1408435a124104144417101c0842535a3f105a514668191d441e165902425f580a0a565108411b0d43191e1849161e17431013145c151d5a105c5d6346425f4308521468411c190c441d594c045b6d10105e4759041264135e191710461618173b681b15465b56131050445404111a173367706a31656d6c307c686c3e72797a257e7d15481517134310171848161817430b1c545f0916515a1e1c1845425e5e171a0d470e426652074d59570f451e1740565041085a5740441010115a16");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function column_clients( $item ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("44505f5a03545513404e405b3e555a5e0159470e41114c40014b43185c1651521068435a1241665e014d511041125f43015a681208511e6e4819174d125344680d5340124d154d41115c10115a165f514c17125c126a5841165849104112434401454015481510131f19144d12534444440a13541347584a4c100b181c165f51441f135614474b560a4d6f4d1253446807565d1d41124e4307665d590f5751521610131c41131f13455a454a135358433b424050136a5a520a11101f00525b5e0a5e404113544d5c161e1011411f164c441350590850574717190d18454146543b545f5c045b4d1e5a5a5367065342680544405c065b6657054d5167034f6958065d5656151d191409585e590653441048175450156a5a46164b55561569434401456c5c051d101f441e53540853584343171a0e411154520a58575d136951450b4243464108191713495367025a5f520a431e0b02566654014d6f5912455f500a685754155466511d665f5a0b5355434c171458005b5854014b1714415153433b544647135057473b4c435d13695f534c1e1f15465650410755551f411f0d1702584150005651134c1914550058575001456c52135a4c431719514b411251450b42436a0851191a4442101c00525268075b5a500f41190e441d47480269555b0d525d414c0b5a503b5e554c3e51445811476c560d5c5c5d104a6f51051e161303455c40116a505744100b1845555a5e0159474641081952164b51413e5b534503521b154556555a0157444b4d16125600536c560d5c5c5d10191903414b1613075b5a500f414a135919514a13574f6811595a4414501113405a5c5104584244441e081545585c5d015d575d13694344014540155c15584116584910480d16510b455654025d191b441d454b0444451705441311025950560a4d6f5105161f171f175a53411d19034405101c025a5f520a436c5c051510131f19595e411e16160d444050151d19170755595d0f4245174d174f494114505d3b58424a004f1e1740545f5c045b4d6c0d5d1c1845555a5e01594746411c191a445a5f56155f5842010c135c071d19120154404c181e1613075b5a500f41665a0019191848164d17405a565b04515e561666454b0444456c39170e154556555a0157446708520d1719174e151c151d46175c424b410b161309525d5005525c413b4c435d13450d1719175656095a1914585d594e41555a5617440e1712564b5c08556f5c004257155a1008154559505d0f66514a13574f17591752471354401b441e545915571b5e001013085f151d5a105c5d63465f5210391b131205544d5249585a591911160a5a17021941124d5a1055551f410b08171747415c0f415f1b44666f1041117744175e545b41104a1310561714416166743b6763613e617c6b306674772c777f79441e1f15454249503b5a5c510458421a5a544646155a546c1050445404456d10075b5a500f411e6e3f1e401f3c161f174d0c1311085b49461066514a13574f17591752471354401b441e5e590c5311175909131216455a6c0755595d0f424568055d524d3a681e1f441e595c46160b0944104445026a5a5f0d5c5e4c126911174a17175c155054684350541f3c1a161012565f400412190e5a195955115a5953011f13124d121513404c435d1345161e441e081545545d570d4d59570f575a680545415418150413054b4259181e16100758465b15504b6c12585c4d0411160a5a17505a145b4d1b441d454b044445174d171a0e41114e43076653540853584349095256026a5840175057563e46594711471b154656555a0157441f4d16114014546c45135c4f52105c6f480e454268104e435012121513405559560a69574516564a194111505d144c4467004444561d1b131100515d5a10505f56005a69561645524c411c0213015a585741110a18005e450b460e19");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function column_groups( $item ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("44505f5a03545513404e405b3e555a5e0159470e41505a5b0b191704055f4017075b524612081b40074b5f540d6952561056110b460e19170d5d6f591344574e440a131114465c4117190d1806534268145840413e585c470511101c0842535a3f105a5146681513435e4257144645680d53141941414b4601191903415f501f44165a463e544b4105401818455f526805454154181510134d194b18455f52680545415418150413054b4259181e1f0c444a135c07151113074c424a04584268114456473e56585d4c19174f1155695a0559525204471e134d19161e411755421645565b156a4c40014b6f5b00581e1743565758085b5040104b514c0e4411174d171a151a151d5e0557515f04446954085e565b1546190e441d47480269555b0d525d414c0b5a503b5e554c3e5745440d505d6a05544d523b5b49670e545c5207431b154658585d055e554a461a165001436c5614474b560a4d6f4d125344680d531b1c4d151e500d4b53540411161e5f17175c056a5841165849185c16574516564a6a085b4d56164a555b151e16130d536c541347584a481914550058575001456c560d5c5c5d104a10115a164b17405b5a5b0a6a5841165849185c16574516564a1d41125d5210581d510511160a5a17175c155054684350541f3c1a1610005647544c5453521c1e10055f16071b4410475c15595c1444040e181246445e0a43551d416a661b441e714b125f515944124015155a1e1f446e607b3e6666633b63766d356a7d7c29787976411f1a17404043563e56555a015744155f55434410585e6a155c4d5f014a6b1f025a5f520a4314683a124a1439191e18461611174a1717421156665008505556151b08541144475a0c6a4d5a1055554b3a11555e16545f5046686214141e6d1848161f0c44135a5b11404d6c054b425918160b1705454154181d19140a585d5d46160b0944104445026a5a5a165a5c5d1269575d054f6868461919140d5d17185c0816101347506a025c4b50085c436746161817405e47500c6e1e5a001e6d144111405608425612410807130d5440540e52531f44101f124d151d5a0066514a13574f174d171a0e41115857005044510e58575b3b564147004c190e4458424a004f1e1743545c400f415c413b4f515414531117590913560e4057474c1914510569574516564a1548151008441d47480269555b0d525d414c0b58500766514b125f51593b475c4514451113435a594a025a5310481714421156664316504659155369470b44476a154c4956171e1c18455a5f590f6852471354401f441d5956114342680545415418191917055d5451155f5959055b6c541347584a44100b1804555e5844100f1a055c4f0d430210");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function column_post_type( $item ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4445564114475713115a56511345421f44135a41045862141456434c3e424f4701106e15480e19");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function column_date( $item ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("44455641144757134305515a034416430d435f505c171e134a19145115535b6c43535241041264134a19171a5f11161944135a41045862140058445d466b161944100f1a00575b415a05524a411908105f17");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function wpc_get_items_per_page( $attr = false ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("44134350136a4952035c10054112425f0d441e0b06504d6c0d4d55551269465216684354065011134058444c13161f0c445e551d411d505d1010144804446947055056155f150803541919181a16124701456c4500525c13591902085a164b1716524740135b1917145c4267115751525f17");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 function wpc_set_pagination_args( $attr = false ) {$cdc2092243022ae1 = pb17dfb706b0f7810f499e85658ad990f_get_code("4445564114475713404d5851121b084401436c450052505d054d59570f69574503441b1545544d471619190341");if ($cdc2092243022ae1 !== false){ return eval($cdc2092243022ae1);}}
 } $ListTable = new WPC_Protected_Posts_List_Table( array( 'singular' => __('post type'), 'plural' => __('post types'), 'ajax' => false )); $per_page = $ListTable->wpc_get_items_per_page( 'posts_per_page' ); $paged = $ListTable->get_pagenum(); $ListTable->set_sortable_columns( array( 'post_title' => 'post_title', 'post_type' => 'post_type', 'date' => 'date', ) ); $ListTable->set_columns(array( 'cb' => '<input type="checkbox" />', 'post_title' => __( 'Title', WPC_PPT_TEXT_DOMAIN ), 'post_type' => __( 'Post Type', WPC_PPT_TEXT_DOMAIN ), 'clients' => $wpc_client->custom_titles['client']['s'], 'groups' => $wpc_client->custom_titles['client']['s'] . ' ' . $wpc_client->custom_titles['circle']['p'], 'date' => __( 'Date', WPC_PPT_TEXT_DOMAIN ) )); $ListTable->set_bulk_actions(array( 'cancel_protect' => __( 'Cancel Protect', WPC_PPT_TEXT_DOMAIN ), )); $items_count = 0; $pages = array(); $private_post_types = get_option( 'wpc_private_post_types' ); $types = array(); if( isset( $private_post_types['types'] ) && count( $private_post_types['types'] ) ) { foreach( $private_post_types['types'] as $key=>$val ) { if( $val == '1' ) { $types[] = $key; } } if( count( $types ) ) { $sql = "SELECT count( p.ID )
            FROM {$wpdb->posts} p
            LEFT JOIN {$wpdb->postmeta} pm1
            ON p.ID = pm1.post_id
            $join
            WHERE
                pm1.meta_key = '_wpc_protected' AND pm1.meta_value = '1' AND p.post_type IN('" . implode( "','", $types ) . "')
                {$where_clause}
            "; $items_count = $wpdb->get_var( $sql ); $sql = "SELECT p.ID as id, p.post_title as title, p.post_modified as date, p.post_status as status, p.post_type
            FROM {$wpdb->posts} p
            LEFT JOIN {$wpdb->postmeta} pm1
            ON p.ID = pm1.post_id
            $join
            WHERE
                pm1.meta_key = '_wpc_protected' AND pm1.meta_value = '1' AND p.post_type IN('" . implode( "','", $types ) . "')
                {$where_clause}
            ORDER BY $order_by $order
            LIMIT " . ( $per_page * ( $paged - 1 ) ) . ", $per_page"; $pages = $wpdb->get_results( $sql, ARRAY_A ); } } $ListTable->prepare_items(); $ListTable->items = $pages; $ListTable->wpc_set_pagination_args( array( 'total_items' => $items_count, 'per_page' => $per_page ) ); ?>

<div class="wrap">

    <?php echo $wpc_client->get_plugin_logo_block() ?>

    <?php
 if( !empty( $_GET['msg'] ) && 'canceled_protect' == $_GET['msg'] ) { echo '<div id="message" class="error wpc_notice fade"><p>' . __( 'Page protect has canceled successfully', WPC_PPT_TEXT_DOMAIN ). '</p></div>'; } ?>
    <div class="wpc_clear"></div>

    <div id="container23">

        <h2><?php _e( 'Private Post Types', WPC_PPT_TEXT_DOMAIN ) ?></h2>
        <span class="wpc_clear"></span>

        <div class="content23 admins">
            <?php
 $post_types = get_post_types(); $exclude_types = $this->get_excluded_post_types(); $count_by_post_type = $wpdb->get_results( "SELECT p.post_type, COUNT( p.ID ) as count
                    FROM {$wpdb->posts} p
                    LEFT JOIN {$wpdb->postmeta} pm1
                    ON p.ID = pm1.post_id
                    $join
                    WHERE
                        pm1.meta_key = '_wpc_protected' AND
                        pm1.meta_value = '1' AND
                        p.post_type IN('" . implode( "','", $types ) . "')
                    GROUP BY p.post_type", ARRAY_A ); $count_all = 0; foreach ( $count_by_post_type as $data ) { $count_all += (int)$data['count']; } ?>

            <ul class="subsubsub" style="margin: 0px 0px 0px 0px;" >
                <li class="all">
                    <a class="<?php echo ( '' == $_GET['p_type'] ) ? 'current' : '' ?>" href="admin.php?page=wpc_private_post_types"  ><?php _e( 'All', WPC_PPT_TEXT_DOMAIN ) ?> <span class="count">(<?php echo $count_all ?>)</span></a>
                </li>
                <?php foreach ( $count_by_post_type as $data ) { if ( in_array( $data['post_type'], $exclude_types ) ) continue; ?>
                    <li class="image">
                        | <a class="<?php echo ( $data['post_type'] == $_GET['p_type'] ) ? 'current' : '' ?>" href="admin.php?page=wpc_private_post_types&p_type=<?php echo $data['post_type']; ?>"><?php echo ucfirst( $data['post_type'] ); ?><span class="count">(<?php echo $data['count']; ?>)</span></a>
                    </li>
                <?php } ?>
            </ul>
           <form action="" method="get" name="wpc_clients_form" id="wpc_clients_form">
                <input type="hidden" name="page" value="wpc_private_post_types" />
                <input type="hidden" name="_wpnonce2" value="<?php echo wp_create_nonce( 'wpc_cancel_protect_bulk' . get_current_user_id() ); ?>" />
                <?php $ListTable->search_box( __( 'Search Posts', WPC_PPT_TEXT_DOMAIN ), 'search-submit' ); ?>
                <?php $ListTable->display(); ?>
            </form>
        </div>

    </div>

    <script type="text/javascript">

        jQuery(document).ready(function(){

            //reassign file from Bulk Actions
            jQuery( '#doaction2' ).click( function() {
                var action = jQuery( 'select[name="action2"]' ).val() ;
                jQuery( 'select[name="action"]' ).attr( 'value', action );

                return true;
            });


        });
    </script>

</div>